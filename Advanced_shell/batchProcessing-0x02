#!/bin/bash

POKEMONS=("Bulbasaur" "Ivysaur" "Venusaur" "Charmander" "Charmeleon")
BASE_URL="https://pokeapi.co/api/v2/pokemon"

fetch_pokemon() {
    local POKEMON="$1"
    local POKE_LOWER
    POKE_LOWER=$(echo "$POKEMON" | tr '[:upper:]' '[:lower:]')
    local OUTPUT_FILE="${POKE_LOWER}.json"

    local attempt=1
    local success=false

    while [ $attempt -le 3 ]; do
        echo "Fetching $POKEMON (attempt $attempt)..."
        if curl -s --fail "${BASE_URL}/${POKE_LOWER}" -o "$OUTPUT_FILE"; then
            echo "$POKEMON data fetched successfully."
            success=true
            break
        else
            echo "Failed to fetch $POKEMON on attempt $attempt."
        fi
        attempt=$((attempt + 1))
    done

    if [ "$success" = false ]; then
        echo "Error: Could not fetch $POKEMON after 3 attempts." >> error.log
    fi
}

echo "Fetching Pok√©mon data in parallel..."
for POKEMON in "${POKEMONS[@]}"; do
    fetch_pokemon "$POKEMON" &
done

wait
echo "All fetching processes completed."
